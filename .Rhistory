# USPS Change of Address 2018-2021 Merging and Analysis
# Created by: Sonia Torres Rodr?guez
# Create date: December 17, 2021
#
#--------------------------------------------------------------------------------------------------
# Load packages
library(tidyverse)
library(lubridate)
library(dplyr)
#Set working directory
setwd("~/GitHub/COA/prog")
# Choose where to save outputs. Default is output folder in the github repo folder.
path <- c("../output/")
# Read in city list and coordinates
year_2018 <- read_csv("../y2018.csv")
year_2019 <- read_csv("../y2019.csv")
year_2020 <- read_csv("../y2020.csv")
year_2021 <- read_csv("../y2021.csv")
View(year_2018)
View(year_2018)
year_2018 <- year_2018 %>%
keep(NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL)
#Create net variables
year_2018$NET_ZIP <-year_2018$TOTAL_TO_ZIP - year_2018$TOTAL_FROM_ZIP
year_2018$NET_BUSINESS <- year_2018$TOTAL_BUSINESS_1 - year_2018$TOTAL_BUSINESS
year_2018$NET_FAMILY <- year_2018$TOTAL_FAMILY_1 - year_2018$TOTAL_FAMILY
year_2018$NET_INDIVIDUAL <- year_2018$TOTAL_INDIVIDUAL_1 - year_2018$TOTAL_INDIVIDUAL
year_2018$NET_PERM <- year_2018$TOTAL_PERM_1 - year_2018$TOTAL_PERM
year_2018$NET_TEMP <- year_2018$TOTAL_TEMP_1 - year_2018$TOTAL_TEMP
year_2019$NET_ZIP <-year_2019$TOTAL_TO_ZIP - year_2019$TOTAL_FROM_ZIP
year_2019$NET_BUSINESS <- year_2019$TOTAL_BUSINESS_1 - year_2019$TOTAL_BUSINESS
year_2019$NET_FAMILY <- year_2019$TOTAL_FAMILY_1 - year_2019$TOTAL_FAMILY
year_2019$NET_INDIVIDUAL <- year_2019$TOTAL_INDIVIDUAL_1 - year_2019$TOTAL_INDIVIDUAL
year_2019$NET_PERM <- year_2019$TOTAL_PERM_1 - year_2019$TOTAL_PERM
year_2019$NET_TEMP <- year_2019$TOTAL_TEMP_1 - year_2019$TOTAL_TEMP
year_2020$NET_ZIP <-year_2020$TOTAL_TO_ZIP - year_2020$TOTAL_FROM_ZIP
year_2020$NET_BUSINESS <- year_2020$TOTAL_BUSINESS_1 - year_2020$TOTAL_BUSINESS
year_2020$NET_FAMILY <- year_2020$TOTAL_FAMILY_1 - year_2020$TOTAL_FAMILY
year_2020$NET_INDIVIDUAL <- year_2020$TOTAL_INDIVIDUAL_1 - year_2020$TOTAL_INDIVIDUAL
year_2020$NET_PERM <- year_2020$TOTAL_PERM_1 - year_2020$TOTAL_PERM
year_2020$NET_TEMP <- year_2020$TOTAL_TEMP_1 - year_2020$TOTAL_TEMP
year_2021$NET_ZIP <-year_2021$TOTAL_TO_ZIP - year_2021$TOTAL_FROM_ZIP
year_2021$NET_BUSINESS <- year_2021$TOTAL_BUSINESS_1 - year_2021$TOTAL_BUSINESS
year_2021$NET_FAMILY <- year_2021$TOTAL_FAMILY_1 - year_2021$TOTAL_FAMILY
year_2021$NET_INDIVIDUAL <- year_2021$TOTAL_INDIVIDUAL_1 - year_2021$TOTAL_INDIVIDUAL
year_2021$NET_PERM <- year_2021$TOTAL_PERM_1 - year_2021$TOTAL_PERM
year_2021$NET_TEMP <- year_2021$TOTAL_TEMP_1 - year_2021$TOTAL_TEMP
#Create net residential variables
year_2018$NET_RESIDENTIAL <- year_2018$NET_FAMILY + year_2018$NET_INDIVIDUAL
year_2019$NET_RESIDENTIAL <- year_2019$NET_FAMILY + year_2019$NET_INDIVIDUAL
year_2020$NET_RESIDENTIAL <- year_2020$NET_FAMILY + year_2020$NET_INDIVIDUAL
year_2021$NET_RESIDENTIAL <- year_2021$NET_FAMILY + year_2021$NET_INDIVIDUAL
year_2018 <- year_2018 %>%
keep(NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL)
View(year_2018)
View(year_2018)
year_2018 <- year_2018 %>%
select(NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL)
View(year_2018)
# Read in city list and coordinates
year_2018 <- read_csv("../y2018.csv")
year_2019 <- read_csv("../y2019.csv")
year_2020 <- read_csv("../y2020.csv")
year_2021 <- read_csv("../y2021.csv")
#Create net variables
year_2018$NET_ZIP <-year_2018$TOTAL_TO_ZIP - year_2018$TOTAL_FROM_ZIP
year_2018$NET_BUSINESS <- year_2018$TOTAL_BUSINESS_1 - year_2018$TOTAL_BUSINESS
year_2018$NET_FAMILY <- year_2018$TOTAL_FAMILY_1 - year_2018$TOTAL_FAMILY
year_2018$NET_INDIVIDUAL <- year_2018$TOTAL_INDIVIDUAL_1 - year_2018$TOTAL_INDIVIDUAL
year_2018$NET_PERM <- year_2018$TOTAL_PERM_1 - year_2018$TOTAL_PERM
year_2018$NET_TEMP <- year_2018$TOTAL_TEMP_1 - year_2018$TOTAL_TEMP
year_2019$NET_ZIP <-year_2019$TOTAL_TO_ZIP - year_2019$TOTAL_FROM_ZIP
year_2019$NET_BUSINESS <- year_2019$TOTAL_BUSINESS_1 - year_2019$TOTAL_BUSINESS
year_2019$NET_FAMILY <- year_2019$TOTAL_FAMILY_1 - year_2019$TOTAL_FAMILY
year_2019$NET_INDIVIDUAL <- year_2019$TOTAL_INDIVIDUAL_1 - year_2019$TOTAL_INDIVIDUAL
year_2019$NET_PERM <- year_2019$TOTAL_PERM_1 - year_2019$TOTAL_PERM
year_2019$NET_TEMP <- year_2019$TOTAL_TEMP_1 - year_2019$TOTAL_TEMP
year_2020$NET_ZIP <-year_2020$TOTAL_TO_ZIP - year_2020$TOTAL_FROM_ZIP
year_2020$NET_BUSINESS <- year_2020$TOTAL_BUSINESS_1 - year_2020$TOTAL_BUSINESS
year_2020$NET_FAMILY <- year_2020$TOTAL_FAMILY_1 - year_2020$TOTAL_FAMILY
year_2020$NET_INDIVIDUAL <- year_2020$TOTAL_INDIVIDUAL_1 - year_2020$TOTAL_INDIVIDUAL
year_2020$NET_PERM <- year_2020$TOTAL_PERM_1 - year_2020$TOTAL_PERM
year_2020$NET_TEMP <- year_2020$TOTAL_TEMP_1 - year_2020$TOTAL_TEMP
year_2021$NET_ZIP <-year_2021$TOTAL_TO_ZIP - year_2021$TOTAL_FROM_ZIP
year_2021$NET_BUSINESS <- year_2021$TOTAL_BUSINESS_1 - year_2021$TOTAL_BUSINESS
year_2021$NET_FAMILY <- year_2021$TOTAL_FAMILY_1 - year_2021$TOTAL_FAMILY
year_2021$NET_INDIVIDUAL <- year_2021$TOTAL_INDIVIDUAL_1 - year_2021$TOTAL_INDIVIDUAL
year_2021$NET_PERM <- year_2021$TOTAL_PERM_1 - year_2021$TOTAL_PERM
year_2021$NET_TEMP <- year_2021$TOTAL_TEMP_1 - year_2021$TOTAL_TEMP
#Create net residential variables
year_2018$NET_RESIDENTIAL <- year_2018$NET_FAMILY + year_2018$NET_INDIVIDUAL
year_2019$NET_RESIDENTIAL <- year_2019$NET_FAMILY + year_2019$NET_INDIVIDUAL
year_2020$NET_RESIDENTIAL <- year_2020$NET_FAMILY + year_2020$NET_INDIVIDUAL
year_2021$NET_RESIDENTIAL <- year_2021$NET_FAMILY + year_2021$NET_INDIVIDUAL
View(year_2018)
year_2018 <- year_2018 %>%
select(YYYYMM, ZIPCODE, CITY, STATE,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL)
View(year_2018)
year_2019 <- year_2019 %>%
select(YYYYMM, ZIPCODE, CITY, STATE,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL)
year_2020 <- year_2020 %>%
select(YYYYMM, ZIPCODE, CITY, STATE,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL)
year_2021 <- year_2021 %>%
select(YYYYMM, ZIPCODE, CITY, STATE,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL)
#Join data frames of all years
list <- list(year_2018,year_2019,year_2020,year_2021)
do.call("rbind", list)
COA_monthly_zip <- do.call("rbind", lapply(list, as.data.frame))
View(COA_monthly_zip)
View(COA_monthly_zip)
COA_monthly_zip$NET_ZIP %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP)
NET_ZIP <- as.double(NET.ZIP)
COA_monthly_zip$NET_ZIP <- as.double(COA_monthly_zip$NET_ZIP$NET.ZIP)
COA_monthly_zip <- COA_monthly_zip %>%
mutate(NET_ZIP = as.double(NET_ZIP),
NET_PERM = as.double(NET_PERM),
NET_TEMP = as.double(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
COA_monthly_zip$NET_ZIP %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP)
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.numeric(NET_RESIDENTIAL))
COA_monthly_zip$NET_ZIP %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP)
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.Date.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.numeric(NET_RESIDENTIAL))
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.Date.numeric(YYYYMM, origin = 201801),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.numeric(NET_RESIDENTIAL))
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.Date.numeric(YYYYMM, origin = "201801"),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.numeric(NET_RESIDENTIAL))
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.Date.numeric(YYYYMM, origin = "%Y%m"),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.numeric(NET_RESIDENTIAL))
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.Date(YYYYMM, origin = "%Y%m"),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.numeric(NET_RESIDENTIAL))
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.Date(YYYYMM, "%Y%m"),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.numeric(NET_RESIDENTIAL))
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.double(YYYYMM),
NET_ZIP = as.double(NET_ZIP),
NET_PERM = as.double(NET_PERM),
NET_TEMP = as.double(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
COA_monthly_zip$NET_ZIP %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP)
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.Date.numeric(YYYYMM, format = "%Y%m"),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.Date.numeric(YYYYMM, origin = "201801"),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.POSIXct(as.numeric(YYYYMM, origin = "201801")),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
COA_monthly_zip$NET_ZIP %>%
select(YYYYMM,NET_ZIP)%>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP)
class(COA_monthly_zip$YYYYMM)
class(COA_monthly_zip$NET_ZIP)
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
COA_monthly_zip$NET_ZIP %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP)
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.character(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
COA_monthly_zip$NET_ZIP %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP)
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
check <- COA_monthly_zip %>%
select(YYYYMM, ZIPCODE, NET_ZIP)
View(check)
check <- COA_monthly_zip %>%
select(YYYYMM, ZIPCODE, NET_ZIP)
COA_monthly_zip$NET_ZIP %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
check <- COA_monthly_zip %>%
select(YYYYMM, ZIPCODE, NET_ZIP)%>%
relocate(ZIPCODE, .before = YYYYMM)
COA_monthly_zip$NET_ZIP %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
list <- list(year_2018,year_2019,year_2020,year_2021)
do.call("rbind", list)
COA_monthly_zip <- do.call("rbind", lapply(list, as.data.frame))
#Adjust type to be able to transpose
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
check <- COA_monthly_zip %>%
select(YYYYMM, ZIPCODE, NET_ZIP)%>%
relocate(ZIPCODE, .before = YYYYMM)
#Transpose
COA_monthly_zip$NET_ZIP %>%
group_by(ZIPCODE) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
check$unique <- pate(check$ZIPCODE, check$YYYYMM)
check$unique <- paste(check$ZIPCODE, check$YYYYMM)
View(check)
COA_monthly_zip$NET_ZIP %>%
group_by(unique) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
check <- COA_monthly_zip %>%
select(YYYYMM, ZIPCODE, NET_ZIP)%>%
relocate(ZIPCODE, .before = YYYYMM)
list <- list(year_2018,year_2019,year_2020,year_2021)
do.call("rbind", list)
COA_monthly_zip <- do.call("rbind", lapply(list, as.data.frame))
#Adjust type to be able to transpose
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))
check <- COA_monthly_zip %>%
select(YYYYMM, ZIPCODE, NET_ZIP)%>%
relocate(ZIPCODE, .before = YYYYMM)
#Transpose
COA_monthly_zip$NET_ZIP
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
check$NET_ZIP %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
NET_ZIP <- NET_ZIP %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
check <- check %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
View(check)
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))%>%
relocate(ZIPCODE, .before = YYYYMM)
#COA_monthly_zip
COA_monthly_zip <- COA_monthly_zip %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_") %>%
pivot_wider(names_from = YYYYMM, values_from = NET_PERM, names_prefix = "NET_PERM_") %>%
pivot_wider(names_from = YYYYMM, values_from = NET_TEMP, names_prefix = "NET_TEMP_") %>%
pivot_wider(names_from = YYYYMM, values_from = NET_RESIDENTIAL, names_prefix = "NET_RES_")
list <- list(year_2018,year_2019,year_2020,year_2021)
do.call("rbind", list)
COA_monthly_zip <- do.call("rbind", lapply(list, as.data.frame))
#Adjust type to be able to transpose
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))%>%
relocate(ZIPCODE, .before = YYYYMM)
#Transposing for each variable and merging again
NET_ZIP <- COA_monthly_zip %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
NET_PERM <- COA_monthly_zip %>%
pivot_wider(names_from = YYYYMM, values_from = NET_PERM, names_prefix = "NET_PERM_") %>%
NET_TEMP <- COA_monthly_zip %>%
pivot_wider(names_from = YYYYMM, values_from = NET_TEMP, names_prefix = "NET_TEMP_")
NET_RES <- COA_monthly_zip%>%
pivot_wider(names_from = YYYYMM, values_from = NET_RESIDENTIAL, names_prefix = "NET_RES_")
NET_PERM <- COA_monthly_zip %>%
pivot_wider(names_from = YYYYMM, values_from = NET_PERM, names_prefix = "NET_PERM_")
NET_TEMP <- COA_monthly_zip %>%
pivot_wider(names_from = YYYYMM, values_from = NET_TEMP, names_prefix = "NET_TEMP_")
View(NET_PERM)
View(NET_ZIP)
NET_ZIP <- COA_monthly_zip %>%
select(ZIPCODE, YYYYMM, NET_ZIP) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
View(NET_ZIP)
list <- list(year_2018,year_2019,year_2020,year_2021)
do.call("rbind", list)
COA_monthly_zip <- do.call("rbind", lapply(list, as.data.frame))
#Adjust type to be able to transpose
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))%>%
relocate(ZIPCODE, .before = YYYYMM)
#Transposing for each variable and merging again
NET_ZIP <- COA_monthly_zip %>%
select(ZIPCODE, YYYYMM, NET_ZIP) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
NET_PERM <- COA_monthly_zip %>%
select(ZIPCODE, YYYYMM, NET_PERM) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_PERM, names_prefix = "NET_PERM_")
NET_TEMP <- COA_monthly_zip %>%
select(ZIPCODE, YYYYMM, NET_TEMP) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_TEMP, names_prefix = "NET_TEMP_")
NET_RES <- COA_monthly_zip%>%
select(ZIPCODE, YYYYMM, NET_RESIDENTIAL) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_RESIDENTIAL, names_prefix = "NET_RES_")
View(NET_RES)
View(COA_monthly_zip)
View(NET_TEMP)
list1 <- list(NET_ZIP,NET_PERM,NET_TEMP,NET_RES)
do.call("rbind", list1)
opend_data_file <- do.call("rbind", lapply(list1, as.data.frame))
View(list1)
public_data_file <- merge(NET_ZIP,NET_PERM, NET_TEMP, NET_RES, by="ZIPCODE")
public_data_file <- merge(NET_ZIP,NET_PERM, by="ZIPCODE")
list <- list(year_2018,year_2019,year_2020,year_2021)
do.call("rbind", list)
COA_monthly_zip <- do.call("rbind", lapply(list, as.data.frame))
#Adjust type to be able to transpose
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))%>%
relocate(ZIPCODE, .before = YYYYMM)
#Transposing for each variable and merging again
NET_ZIP <- COA_monthly_zip %>%
select(ZIPCODE, YYYYMM, NET_ZIP) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_ZIP, names_prefix = "NET_ZIP_")
NET_PERM <- COA_monthly_zip %>%
select(ZIPCODE, YYYYMM, NET_PERM) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_PERM, names_prefix = "NET_PERM_")
NET_TEMP <- COA_monthly_zip %>%
select(ZIPCODE, YYYYMM, NET_TEMP) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_TEMP, names_prefix = "NET_TEMP_")
NET_RES <- COA_monthly_zip%>%
select(ZIPCODE, YYYYMM, NET_RESIDENTIAL) %>%
pivot_wider(names_from = YYYYMM, values_from = NET_RESIDENTIAL, names_prefix = "NET_RES_")
merge1 <- merge(NET_ZIP,NET_PERM, by="ZIPCODE")
merge1 <- merge(NET_ZIP,NET_PERM, by="ZIPCODE")
merge2 <- merge(merge1, NET_TEMP, by = "ZIPCODE")
public_data_file <- merge(merge2, NET_RES, by = "ZIPCODE")
View(public_data_file)
write.csv(public_data_file, file.path(path, "COA_publicdatafile.csv"))
View(NET_ZIP)
COA_monthly_zip <- do.call("rbind", lapply(list, as.data.frame))
write.csv(COA_monthly_zip, file.path(path, "check.csv"))
#Join data frames of all years
list <- list(year_2018,year_2019,year_2020,year_2021)
do.call("rbind", list)
COA_monthly_zip <- do.call("rbind", lapply(list, as.data.frame))
#Adjust type to be able to transpose
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))%>%
relocate(ZIPCODE, .before = YYYYMM)
write.csv(COA_monthly_zip, file.path(path, "check.csv"))
#Join data frames of all years
list <- list(year_2018,year_2019,year_2020,year_2021)
do.call("rbind", list)
COA_monthly_zip <- do.call("rbind", lapply(list, as.data.frame))
#Adjust type to be able to transpose
COA_monthly_zip <- COA_monthly_zip %>%
mutate(YYYYMM = as.numeric(YYYYMM),
NET_ZIP = as.numeric(NET_ZIP),
NET_PERM = as.numeric(NET_PERM),
NET_TEMP = as.numeric(NET_TEMP),
NET_RESIDENTIAL = as.double(NET_RESIDENTIAL))%>%
relocate(ZIPCODE, .before = YYYYMM)
write.csv(COA_monthly_zip, file.path(path, "check.csv"))
