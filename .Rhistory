head()
View(flows_2018)
flows_2018 %>%
filter(variable == "MOVEDNET") %>%
arrange(estimate) %>%
head()
View(flows_2018)
flows_2018 %>%
keep(variable == "MOVEDNET") %>%
arrange(estimate) %>%
head()
flows_2018 %>%
keep(variable == "MOVEDNET") %>%
arrange(estimate)
flows_2018 <- get_flows(
geography = "county",
year = 2018
)
flows_2018 %>%
filter(variable == "MOVEDNET") %>%
arrange(estimate)
View(flows_2018)
flows_2018 <- flows_2018%>%
filter(variable == "MOVEDNET") %>%
arrange(estimate)
View(flows_2018)
View(flows_2018)
flows_2018 %>%
group_by(GEOID1) %>%
summarise(estimate = sum(estimate))%>%
distinct(GEOID1)%>%
select(-GEOID2, -FULL2_NAME, -moe)
flows_2018 %>%
group_by(GEOID1) %>%
summarise(estimate = sum(estimate))%>%
distinct(GEOID1)
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
summarise(estimate = sum(estimate))%>%
distinct(GEOID1)%>%
select(-GEOID2, -FULL2_NAME, -moe)
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
summarise(estimate = sum(estimate))%>%
distinct(GEOID1)
View(net_mig_2018)
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
mutate(estimate = sum(estimate))%>%
distinct(GEOID1)%>%
select(-GEOID2, -FULL2_NAME, -moe)
View(net_mig_2018)
flows_2018 <- flows_2018 %>%
filter(variable == "MOVEDNET") %>%
arrange(estimate)
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
mutate(estimate = sum(estimate))%>%
distinct(GEOID1)%>%
select(-GEOID2, -FULL2_NAME, -moe)
View(flows_2018)
View(net_mig_2018)
View(flows_2018)
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
mutate(estimate = sum(estimate))
View(net_mig_2018)
net_mig_2018 <- flows_2018 %>%
select(-GEOID2, -FULL2_NAME, -moe) %>%
group_by(GEOID1) %>%
mutate(estimate = sum(estimate))%>%
distinct(GEOID1)
net_mig_2018 <- flows_2018 %>%
select(-GEOID2, -FULL2_NAME, -moe) %>%
group_by(GEOID1)
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
mutate(estimate = sum(estimate))
net_mig_2018 <- flows_2018 %>%
group_by("GEOID1") %>%
mutate(estimate = sum(estimate))
net_mig_2018 <- flows_2018 %>%
group_by(FULL1_NAME) %>%
mutate(estimate = sum(estimate))
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
mutate(net = sum("estimate"))
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
mutate(estimate = as.numeric(estimate)) %>%
mutate(net = sum("estimate"))
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
mutate(estimate = as.numeric(estimate)) %>%
mutate(net = sum(estimate))
View(net_mig_2018)
net_mig_2018 <- flows_2018 %>%
mutate(estimate = as.numeric(estimate),
GEOID1 = as.numeric(GEOID1)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))
net_mig_2018 <- flows_2018 %>%
group_by("GEOID1") %>%
mutate(net = sum(estimate))
net_mig_2018 <- flows_2018 %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))
net_mig_2018 <- flows_2018 %>%
filter(!is.na(GEOID2)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))
net_mig_2018 <- flows_2018 %>%
filter(!is.na(GEOID2)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))%>%
distinct(GEOID1)
select(-GEOID2, -FULL2_NAME, -moe)
net_mig_2018 <- flows_2018 %>%
filter(!is.na(GEOID2)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))%>%
distinct(GEOID1, .keep_all= TRUE)
select(-GEOID2, -FULL2_NAME, -moe)
net_mig_2018 <- flows_2018 %>%
filter(!is.na(GEOID2)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))%>%
distinct(GEOID1, .keep_all= TRUE)
net_mig_2018 <- flows_2018 %>%
filter(!is.na(GEOID2)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))%>%
distinct(GEOID1, .keep_all= TRUE) %>%
select(-GEOID2, -FULL2_NAME, -moe)
net_mig_2018 <- flows_2018 %>%
filter(!is.na(GEOID2)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))%>%
distinct(GEOID1, .keep_all= TRUE) %>%
select(-GEOID2, -FULL2_NAME, -estimate, -moe)
net_mig_2018 <- flows_2018 %>%
filter(!is.na(GEOID2)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))%>%
distinct(GEOID1, .keep_all= TRUE) %>%
select(-GEOID2, -FULL2_NAME, -estimate, -moe, -variable)
flows_2020 <- get_flows(
geography = "county",
year = 2020
)
flows_2019 <- get_flows(
geography = "county",
year = 2019
)
View(flows_2019)
crosswalk <- read_csv("../zip_county_crosswalk.csv")
View(crosswalk)
crosswalk <- crosswalk %>%
rename(ZIPCODE = ZIP) %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0"))
zcta_join2018 <- year_2018 %>%
left_join(crosswalk, by="ZIPCODE")
zcta_join2018$Year <- "2018"
View(year_2018)
zcta_join2018 <- year_2018 %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0")) %>%
left_join(crosswalk, by="ZIPCODE")
zcta_join2018$Year <- "2018"
View(zcta_join2018)
county_COA_2018 <- zcta_join2018 %>%
group_by(YYYYMM, COUNTYNM) %>%
mutate(NET_ZIP = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
relocate(COUNTY, .before = CITY.x) %>%
relocate(COUNTYNM, .before = CITY.x) %>%
select(YYYYMM, COUNTY, COUNTYNM,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL)
View(county_COA_2018)
#Join the crosswalk to the COA zipcode data
zcta_join2018 <- year_2018 %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0")) %>%
left_join(crosswalk, by="ZIPCODE")
county_COA_2018 <- zcta_join2018 %>%
group_by(YYYYMM, COUNTYNM) %>%
mutate(NET_ZIP = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
relocate(COUNTY, .before = CITY.x) %>%
relocate(COUNTYNM, .before = CITY.x) %>%
select(YYYYMM, COUNTY, COUNTYNM,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(COUNTYNM, .keep_all= TRUE)
county_COA_2018 <- zcta_join2018 %>%
group_by(YYYYMM, COUNTYNM) %>%
mutate(NET_ZIP = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
relocate(COUNTY, .before = CITY.x) %>%
relocate(COUNTYNM, .before = CITY.x) %>%
select(YYYYMM,COUNTYNM,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(COUNTYNM, .keep_all= TRUE)
View(net_mig_2018)
county_COA_2018 <- zcta_join2018 %>%
group_by(YYYYMM, COUNTYNM) %>%
mutate(NET_ZIP = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
relocate(COUNTY, .before = CITY.x) %>%
relocate(COUNTYNM, .before = CITY.x)
View(county_COA_2018)
net_mig_2018$COUNTYNM <- word(net_mig_2018$FULL1_NAME, 1)
net_mig_2018$COUNTYNM <- word(net_mig_2018$FULL1_NAME, 1 & 2)
countynm <- net_mig_2018 %>%
select(COUNTYNM)
View(countynm)
countynm <- county_COA_2018) %>%
select(COUNTYNM)
countynm <- county_COA_2018 %>%
select(COUNTYNM)
View(countynm)
countynm <- county_COA_2018 %>%
unlist() %>%
select(COUNTYNM)
countynm <- county_COA_2018 %>%
select(COUNTYNM) %>%
select(-YYYYMM)
countynm <- county_COA_2018 %>%
unlist(YYYYMM) %>%
select(COUNTYNM)
county_COA_2018 <- zcta_join2018 %>%
group_by(YYYYMM, COUNTYNM) %>%
mutate(NET_ZIP = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
relocate(COUNTY, .before = CITY.x) %>%
relocate(COUNTYNM, .before = CITY.x) %>%
select(YYYYMM,COUNTYNM,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(COUNTYNM, .keep_all= TRUE)
countynm <- county_COA_2018 %>%
unlist(YYYYMM) %>%
select(COUNTYNM)
countynm <- county_COA_2018 %>%
unlist("YYYYMM") %>%
select(COUNTYNM)
countynm <- county_COA_2018 %>%
unlist() %>%
select(COUNTYNM)
countynm <- county_COA_2018 %>%
select(COUNTYNM)
countynm <- county_COA_2018 %>%
select(COUNTYNM) %>%
distinct(COUNTYNM)
countynm <- county_COA_2018 %>%
select(COUNTYNM) %>%
group_by(COUNTYNM) %>%
distinct(COUNTYNM)
countynm_vector <- countynm$COUNTYNM
net_mig_2018$COUNTYNM <- str_extract_all(FULL1_NAME, str_c(countynm_vector))
test <- net_mig_2018 %>%
mutate(COUNTYNM = str_extract_all(FULL1_NAME, str_c(countynm_vector)))
county_COA_2018 <- zcta_join2018 %>%
group_by(COUNTYNM) %>%
mutate(NET_ZIP = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
relocate(COUNTY, .before = CITY.x) %>%
relocate(COUNTYNM, .before = CITY.x) %>%
select(YYYYMM,COUNTYNM,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(COUNTYNM, .keep_all= TRUE)
county_COA_2018 <- zcta_join2018 %>%
group_by(COUNTYNM) %>%
mutate(NET_ZIP = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
relocate(COUNTY, .before = CITY.x) %>%
relocate(COUNTYNM, .before = CITY.x) %>%
select(COUNTYNM,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(COUNTYNM, .keep_all= TRUE)
View(zcta_join2018)
View(county_COA_2018)
View(crosswalk)
crosswalk <- read_csv("../ZIP_COUNTY_032018.csv")
View(crosswalk)
crosswalk <- crosswalk %>%
rename(ZIPCODE = zip) %>%
mutate(ZIPCODE = as.numeric(ZIPCODE))
crosswalk <- crosswalk %>%
rename(ZIPCODE = zip) %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0"))
crosswalk <- read_csv("../ZIP_COUNTY_032018.csv")
crosswalk <- crosswalk %>%
rename(ZIPCODE = zip) %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0"))
crosswalk <- crosswalk %>%
rename(ZIPCODE = zip) %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0")) %>%
rename(GEOID1 = county)
crosswalk <- read_csv("../ZIP_COUNTY_032018.csv")
#Rename zipcode to match the original data
crosswalk <- crosswalk %>%
rename(ZIPCODE = zip) %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0")) %>%
rename(GEOID1 = county)
net_mig_2018 <- flows_2018 %>%
filter(!is.na(GEOID2)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))%>%
distinct(GEOID1, .keep_all= TRUE) %>%
select(-GEOID2, -FULL2_NAME, -estimate, -moe, -variable)
zip_join2018 <- year_2018 %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0")) %>%
left_join(crosswalk, by="ZIPCODE")
View(zip_join2018)
county_COA_2018 <- zip_join2018 %>%
group_by(GEOID1) %>%
mutate(NET_ZIP = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
select(GEOID1,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(GEOID1, .keep_all= TRUE)
View(county_COA_2018)
zip_join2018 <- year_2018 %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0")) %>%
left_join(crosswalk, by="ZIPCODE")
county_COA_2018 <- zip_join2018 %>%
group_by(GEOID1) %>%
mutate(NET_ZIP = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
select(GEOID1,STATE,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(GEOID1, .keep_all= TRUE)
install.packages("tidylog")
comparing_flows <- county_COA_2018 %>%
tidylog::left_join(net_mig_2018, by="ZIPCODE")
comparing_flows <- county_COA_2018 %>%
tidylog::left_join(net_mig_2018, by="GEOID1")
View(comparing_flows)
comparing_flows$difference <- comparing_flows$net - comparing_flows$NET_ZIP
comparing_flows <- county_COA_2018 %>%
tidylog::left_join(net_mig_2018, by="GEOID1")%>%
filter(!is.na(net))
comparing_flows$difference <- comparing_flows$net - comparing_flows$NET_ZIP
install.packages("ggpubr")
library("ggpubr")
ggscatter(my_data, x = "NET_ZIP", y = "net",
add = "reg.line", conf.int = TRUE,
cor.coef = TRUE, cor.method = "pearson",
xlab = "USPS COA 2018 net", ylab = "Census Mobility 2018 net")
ggscatter(comparing_flows, x = "NET_ZIP", y = "net",
add = "reg.line", conf.int = TRUE,
cor.coef = TRUE, cor.method = "pearson",
xlab = "USPS COA 2018 net", ylab = "Census Mobility 2018 net")
ggscatter(comparing_flows, x = "NET_ZIP", y = "net",
add = "reg.line", conf.int = TRUE,
cor.coef = TRUE, cor.method = "pearson",
xlab = "USPS COA 2018 net", ylab = "Census Mobility 2018 net")
write.csv(comparing_flows, file.path(path, "Census_Validity_Check.csv"))
#Validating USPS COA counts with census data
library(tidycensus)
library(tidyverse)
library(tigris)
options(tigris_use_cache = TRUE)
# Use Census API key
census_api_key("e0e50dbbc586496e193c885ba478cae24f3150b3", overwrite = FALSE, install = FALSE)
#Reference: https://walker-data.com/tidycensus/articles/other-datasets.html#migration-flows-1
#Call migration flows (lowest level is county) - only available up to year 2019
flows_2018 <- get_flows(
geography = "county",
year = 2018
)
flows_2018 <- flows_2018 %>%
filter(variable == "MOVEDNET") %>%
arrange(estimate)
#Group all of the net movement by county (must get rid of NAs from out of the country)
net_mig_2018 <- flows_2018 %>%
filter(!is.na(GEOID2)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))%>%
distinct(GEOID1, .keep_all= TRUE) %>%
select(-GEOID2, -FULL2_NAME, -estimate, -moe, -variable)
#Convert COA zip code counts for year 2018 to county level
#Read in crosswalk file, from here: https://www.huduser.gov/portal/datasets/usps_crosswalk.html
crosswalk <- read_csv("../ZIP_COUNTY_032018.csv")
#Rename zip code to match the original data
crosswalk <- crosswalk %>%
rename(ZIPCODE = zip) %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0")) %>%
rename(GEOID1 = county)
#Convert the monthly zip flows from USPS COA to yearly county flows
zip_join2018 <- year_2018 %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0")) %>%
left_join(crosswalk, by="ZIPCODE")
county_COA_2018 <- zip_join2018 %>%
group_by(GEOID1) %>%
mutate(NET_COUNTY = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
select(GEOID1,STATE,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(GEOID1, .keep_all= TRUE)
#Join the Census data to the USPS COA data to compare
comparing_flows <- county_COA_2018 %>%
tidylog::left_join(net_mig_2018, by="GEOID1")%>%
filter(!is.na(net))
#Calculating difference between census data and USPS COA data
comparing_flows$difference <- comparing_flows$net - comparing_flows$NET_ZIP
write.csv(comparing_flows, file.path(path, "Census_Validity_Check.csv"))
#Calculate correlate, reference: http://www.sthda.com/english/wiki/correlation-test-between-two-variables-in-r
library("ggpubr")
ggscatter(comparing_flows, x = "NET_COUNTY", y = "net",
add = "reg.line", conf.int = TRUE,
cor.coef = TRUE, cor.method = "pearson",
xlab = "USPS COA 2018 net", ylab = "Census Mobility 2018 net")
flows_2018 <- flows_2018 %>%
filter(variable == "MOVEDNET") %>%
arrange(estimate)
#Group all of the net movement by county (must get rid of NAs from out of the country)
net_mig_2018 <- flows_2018 %>%
filter(!is.na(GEOID2)) %>%
group_by(GEOID1) %>%
mutate(net = sum(estimate))%>%
distinct(GEOID1, .keep_all= TRUE) %>%
select(-GEOID2, -FULL2_NAME, -estimate, -moe, -variable)
#Convert COA zip code counts for year 2018 to county level
#Read in crosswalk file, from here: https://www.huduser.gov/portal/datasets/usps_crosswalk.html
crosswalk <- read_csv("../ZIP_COUNTY_032018.csv")
#Rename zip code to match the original data
crosswalk <- crosswalk %>%
rename(ZIPCODE = zip) %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0")) %>%
rename(GEOID1 = county)
#Convert the monthly zip flows from USPS COA to yearly county flows
zip_join2018 <- year_2018 %>%
mutate(ZIPCODE = as.numeric(ZIPCODE),
ZIPCODE = str_pad(ZIPCODE, 5, side = c("left"), pad = "0")) %>%
left_join(crosswalk, by="ZIPCODE")
county_COA_2018 <- zip_join2018 %>%
group_by(GEOID1) %>%
mutate(NET_COUNTY = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
select(GEOID1,STATE,NET_ZIP, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(GEOID1, .keep_all= TRUE)
#Join the Census data to the USPS COA data to compare
comparing_flows <- county_COA_2018 %>%
tidylog::left_join(net_mig_2018, by="GEOID1")%>%
filter(!is.na(net))
#Calculating difference between census data and USPS COA data
comparing_flows$difference <- comparing_flows$net - comparing_flows$NET_ZIP
write.csv(comparing_flows, file.path(path, "Census_Validity_Check.csv"))
View(comparing_flows)
county_COA_2018 <- zip_join2018 %>%
group_by(GEOID1) %>%
mutate(NET_COUNTY = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
select(GEOID1,STATE,NET_COUNTY, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(GEOID1, .keep_all= TRUE)
View(county_COA_2018)
#Join the Census data to the USPS COA data to compare
comparing_flows <- county_COA_2018 %>%
tidylog::left_join(net_mig_2018, by="GEOID1")%>%
filter(!is.na(net))
#Calculating difference between census data and USPS COA data
comparing_flows$difference <- comparing_flows$net - comparing_flows$NET_ZIP
write.csv(comparing_flows, file.path(path, "Census_Validity_Check.csv"))
county_COA_2018 <- zip_join2018 %>%
group_by(GEOID1) %>%
mutate(NET_COUNTY = sum(NET_ZIP),
NET_PERM = sum(NET_PERM),
NET_TEMP = sum(NET_TEMP),
NET_RESIDENTIAL = sum(NET_RESIDENTIAL)) %>%
select(GEOID1,STATE,NET_COUNTY, NET_PERM, NET_TEMP, NET_RESIDENTIAL) %>%
distinct(GEOID1, .keep_all= TRUE)
#Join the Census data to the USPS COA data to compare
comparing_flows <- county_COA_2018 %>%
tidylog::left_join(net_mig_2018, by="GEOID1")%>%
filter(!is.na(net))
#Calculating difference between census data and USPS COA data
comparing_flows$difference <- comparing_flows$net - comparing_flows$NET_COUNTY
#Calculate correlate, reference: http://www.sthda.com/english/wiki/correlation-test-between-two-variables-in-r
library("ggpubr")
ggscatter(comparing_flows, x = "NET_COUNTY", y = "net",
add = "reg.line", conf.int = TRUE,
cor.coef = TRUE, cor.method = "pearson",
xlab = "USPS COA 2018 net", ylab = "Census Mobility 2018 net")
write.csv(comparing_flows, file.path(path, "Census_Validity_Check.csv"))
